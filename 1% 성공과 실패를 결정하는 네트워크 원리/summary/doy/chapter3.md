# chapter 3 전체 정리

## 전체 흐름
클라이언트 측 프로토콜 스택 - LAN 어댑터를 통해 패킷은 전기 신호로 변환되어 케이블에 송출된다. (2장 내용)   
이 장에서는 케이블에 송출한 패킷이 리피터 허브, 스위칭 허브, 라우터 등의 네트워크 기기를 경유하여 인터넷을 향해 진행하는 부분을 다룬다.  

### 1. 케이블을 통해 리피터 허브 등을 경유
- 케이블에 송출된 패킷은 허브나 라우터에 의해 중계되어 목적지로 향한다.
- 데이터 단위가 아니라 하나 하나의 패킷이 독립적으로 동작한다.
  - 중계 장치는 데이터 부분을 보지 않기 때문에, 데이터나 TCP 프로토콜의 제어 정보는 패킷 운반 동작에 영향을 주지 않는다.
  > 이 때 패킷은 계층을 구분해 설명하자면 프레임?
- LAN 케이블 신호를 약화시키지 않는 것이 중요하다.
  - 잡음을 방지하기 위한 주요 대책으로 케이블을 마주꼬는 것이 있다.
- 리피터 허브는 자신이 연결된 케이블 전부에 신호를 그대로 뿌린다.
  - 해당 신호를 받은 기기 중 MAC 주소에 해당하는 기기만 패킷을 수신한다.

### 2. 스위칭 허브의 패킷 중계 동작
- 스위칭 허브는 송수신 동작 시 전기 신호 ↔️ 디지털 데이터 변환을 거쳐서 패킷을 운반한다.
- 스위칭 허브는 MAC 주소표를 이용해, 스위치 회로를 통해 이더넷의 패킷을 특정 포트로 중계한다.
  - MAC 주소표에는 송신처 주소(목적지 기기의 MAC 주소)와 수신 포트가 있다.
  - 이를 통해 수신할 포트를 결정한다.
- 스위칭 허브는 리피터 허브와 달리, 복수의 패킷 중계 동작을 동시에 실행할 수 있다.
    - 스위치 회로는 여러 개의 입,출력 포트를 가진 격자 모양의 전자 회로이기 때문이다.
    - 수신 포트 외의 다른 포트는 빈 상태이기 때문이다.
- 주소표에 일치하는 주소가 없다면, 전체 포트에서 패킷을 송신한다.
- 송신과 수신을 동시에 실행할 수 있는 전이중 모드를 사용한다.

### 3. 라우터의 패킷 중계 동작
- 라우터는 스위칭 허브와 달리, IP 주소를 바탕으로 패킷을 중계한다.
- 라우터의 각 포트에는 MAC 주소와 IP 주소가 할당되어 있다
  - 라우터 자체가 송신처/수신처가 될 수 있다.
- 수신처 IP 주소와 중계 대상을 등록한 라우팅 테이블을 기준으로 중계한다.
  - 수신처(서브넷 주소), 넷마스크, 게이트웨이(중계 대상의 IP 주소), 인터페이스(라우터의 포트), 메트릭(얼마나 먼지) 로 이루어짐.
- 패킷의 수신처 MAC 주소가 자신에 해당하면 버퍼에 저장 이후 중계 동작, 아니면 폐기한다.
- 중계표에 해당하는 경로가 없다면 패킷을 폐기하고 ICMP 프로토콜을 사용해 송신처에 이 사실을 통지한다.

### * 라우터와 스위칭 허브
- 라우터는 IP의 개념에, 스위칭 허브는 이더넷에 기초하여 만들어졌다.
- 라우터는 패킷을 운반하는 일을 스위칭 허브에 의뢰한다.


### 4. 라우터의 부가 기능 : 주소 변환, 패킷 필터링
- 주소 변환으로 IP 주소를 효율적으로 이용할 수 있다.
  - 특정 주소 범위를 사내용에서 쓰도록 정하고, 그 안에서 프라이빗 주소를 나누어 쓸 수 있다.
  - 대신 주소 중복을 피해야 하기 때문에 사내 ↔️ 인터넷 왕래 시 글로벌 주소로의 변환이 필요하다.
- 라우터의 주소 변환은 패킷의 송신처 IP 주소를 프라이빗 주소에서 글로벌 주소로 바꿔 쓴다.
  - 이 때 글로벌 주소는 인터넷 측에 있는 포트에 할당된 주소이다.
  - 포트 번호도 미사용중인 것을 임의로 새로 지정한다.
  - 글로벌 주소와 포트 번호를 세트로 주소 변환한다. (1:1 대응이 아니라 1:수만개로 처리하기 위함)
  - 글로벌 주소와 포트 번호를 세트로 주소 변환 장치 내부 대응표에 기록한다.
  - 이 주소는 인터넷에 대한 접속 동작이 끝난면 삭제한다. (일회적인 사용)
- 라우터에서 방화벽처럼 헤더 정보에 따라 패킷을 폐기하거나 중계하는 역할을 할 수 있다.

## 질문
### 케이블에서 송출된 패킷을 중계할 때, 패킷의 데이터 부분이나 TCP 제어 정보도 필요할까?
### 라우터와 스위칭 허브의 중계 동작에서 차이점은?
### 라우터에서 주소 변환을 할 때 포트 번호도 세트로 지정하는 이유는?