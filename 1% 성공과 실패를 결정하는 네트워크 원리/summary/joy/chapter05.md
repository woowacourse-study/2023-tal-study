# Chapter 05 Summary  
> 서버측의 LAN에는 무엇이 있는가?  

## 웹 서버의 설치 장소  
- 사내에 웹 서버 설치
  - 인터넷을 빠져나와 패킷이 서버에 도착하기까지의 과정은, 서버의 설치 장소에 따라 다르다.  
  - 과거에는 사내 LAN에 웹 서버를 설치해 라우터가 패킷을 직접 중계하기도 했지만, 현재는 방화벽으로 웹 서버를 분리하는 것이 일반적이다.  
  - IP 주소의 부족, 보안이 그 이유이다.
  - 방벽은 일종의 관문 역할을 하며, 특정 애플리케이션에 액세스하는 패킷만 통과시키게 하고 외의 것은 차단한다.  

- 데이터 센터에 웹 서버 설치
  - 인터넷의 중심 부분 -> 데이터 센터 -> 서버 머신 -> 방화벽 점검(있다면) -> 서버
  - 사내보다 안정성이 높고, 고속 회선으로 접속되어 고속 액세스 가능


<br><br>

## 방화벽의 원리와 동작  
### 패킷 필터링형
> 방화벽이 패킷을 선별하는 방법은 다양하다.  
> 성능, 가격, 사용 편의성 등을 이유로 `패킷 필터링형`이 가장 많이 보급 되었다.   

<br><br>

### 조건 설정
> 여러 가지 조건들을 조합하여 패킷 필터링을 한다. 
> 하지만 항상 완벽하게 차단/통과시킬 수 있는 것은 아니다.

- 패킷 필터링형은 패킷 헤더의 제어 정보를 조사해 조건을 설정한다.  
- 자주 사용하는 헤더로는 `송신처 MAC 주소`, `송/수신처 IP 주소`, `프로토콜 번호`, `송/수신처 포트번호`, `TCP 컨트롤 비트`, `프래그먼트`가 있다.  
- ICMP 메시지의 내용도 조건 설정에 사용한다.
- 서버에서 다른 서버로 부정 소프트웨어의 감염을 막기 위해, 별도 허가 없이는 웹 서버에서 인터넷 측에 액세스하는 것을 금지한다. 이 때도 패킷 필터링의 조건을 설정한다.
  - 수신처 IP 주소와 송신처 IP 주소로 시점과 종점을 판단

<br><br>

####  포트 번호로 애플리케이션을 한정하기
- 불필요한 패킷을 모두 차단하기 위해 애플리케이션을 한정하기 위해, TCP 헤더나 UDP 헤더에 기록된 포트 번호를 조건으로 추가한다.  

<br><br>

#### 컨트롤 비트로 접속 방향 판단
- 액세스 동작을 정지시키려면, 양방향의 패킷 흐름 중 액세스하는 방향을 판단해야 한다. 이 때 컨트롤 비트를 이용한다.
- 컨트롤 비트의 SYN이 1이고 ACK가 0인 패킷은 최초의 패킷 뿐이다.
- 최초의 패킷을 차단하면, 상대로부터 돌아오는 패킷이 없으므로 TCP 접속 동작이 실패한다.

이외에도 사내 LAN - 공개 서버용 LAN 사이의 패킷에도 조건 설정이 필요하다.


<br><br>

### 방화벽과 라우터  
- 패킷 필터링이라는 구조는 특별한 것이 아니고, 라우터의 패킷 중계 기능 중 부가 기능이라고 생각하는 것이 좋다.
- 방화벽은 시점과 종점만 조사하기 때문에 그 외의 내용이 위험한 패킷을 전부 판단할 수는 없다.

<br><br>

## 캐시 서버를 이용한 서버의 부하 분산  
> 서버의 부하를 처리하는 방법은 다양하며, 역할 별 분산 처리 방법 중 하나가 캐시 서버를 이용하는 것이다.  

캐시 서버는 프록시 구조를 이용한 데이터를 캐시에 저장하는 서버 이다.  
캐시 서버는 캐시 서버는 보존해 둔 데이터를 읽어서 송신하므로 빠르게 데이터를 송신할 수 있다.  
캐시 서버에서 액세스 동작을 고속화 한다면 전체 성능 향상이 가능하며, 웹 서버 처리 시간을 단축시킬 수 있다.  

<br><br>

### 포워드 프록시
> 포워드 프록시는 클라이언트 측에 캐시 서버를 두는 방법이다.  
> 프록시에서 요청을 받고 인터넷에 전송하면 필요한 것을 통과시킬 수 있다.

포워드 프록시를 사용하면 내용에 따라 액세스가 가능한지 판단 가능하기 때문에 위험한 사이트에 대한 액세스를 제한할 수 있다.  

<br><br>

### 리버시 프록시
> 포워드 프록시는 브라우저에 대한 설정이 필요하여 번거롭고, 잘못된 경우 브라우저가 제대로 작동하지 않을 수 있다.  

브라우저에 프록시를 설정하지 않아도 사용할 수 있도록 개량되었다.
리퀘스트 메시지의 URI에 적혀있는 디렉토리명과 전송 대상의 웹 서버를 대응 시켜 리퀘스트 메시지를 전송할 수 있도록 하였다.  

<br><br>

### 트랜스페어런트 프록시
> 캐시 서버에서 전송 대상을 판단하는 방법으로 리퀘스트 메시지 패킷의 헤더를 조사하는 방법으로, 수신처 IP를 확인해 웹 서버가 어디있는지 알 수 있는데 이 방법이 트랜스페어런트 프록시이다.  
> 포워드 프록시처럼 브라우저에 설정할 필요 없으며, 리버스 프록시처럼 캐시 서버에 설정할 필요도 없다.  

- 리퀘스트 메시지가 흐르는 길이 많으면 길이 한 개로 수렴하는 형태로 네트워크를 만들고, 수렴하는 곳에 트랜스페어런트 프록시를 설치한다.
- 트랜스페어런트 프록시를 사용하면 사용자가 프록시의 존재를 알아차릴 필요가 없다.

<br><br>

## 콘텐츠 배포 서비스  
> 콘텐츠 배포 서비스 (CDS, Content Delivery Service) 는 인터넷에 다수의 캐시 서버를 설치하고, 이것을 웹 서버 운영자에게 대출하는 서비스이다.  
> 이 서비스를 제공하는 사업자를 CDSP(Content Delivery Service Provider)라 부른다.  

<br><br>

### 캐시 서버의 배치 장소에 다른 비교
- 서버 측의 LAN (웹 서버 직전): 웹 서버의 부하를 경감 가능하지만, 인터넷을 흐르는 트래픽은 억제할 수 없다.
- 클라이언트 측의 LAN: 인터넷의 트래픽 억제가 가능하지만, 웹서버 운영자가 캐시 서버를 제어할 수 없고, 클라이언트 측에 캐시 서버가 있다고 단정할 수 없다.
- 인터넷 주위 (클라이언트 측의 프로바이더): 사용자로부터 가까운 장소에 캐시 서버를 설치하면서(인터넷 트래픽 억제), 이를 웹 서버 운영자가 제어할 수 있다.

인터넷에 공개하는 서버는 인터넷의 어디에서 액세스하는지 모르는데, 그러면 프로바이더의 모든 POP에 캐시 서버를 설치해야 한다.  
프로바이더에 중점을 두면, 캐시 서버의 수를 줄일 수 있다.    
웹 서버 운영자가 스스로 프로바이더와 계약하여 캐시 서버를 설치하는 것은 비용 면, 노력 면에서 쉽지 않다.  
그래서 콘텐츠 배포 서비스를 이용하는 것이다.  

<br><br>

### 가장 가까운 캐시 서버에 액세스하기
> 콘텐츠 배포 서비스를 사용하는 경우, 다수의 캐시 서버를 이용하기에 가장 가까운 캐시 서버를 찾아내고 클라이언트의 액세스를 위해 중재하는 구조가 필요하다.  
> 그 방법으로 `DNS 서버에서 설정`, `리피터용 서버로 액세스 대상 분배`, `거리 계산` 등이 있다.  

<br><br>

### 캐시 내용의 갱신 방법, 성능의 차이
> 캐시의 내용을 갱신하는 방법은 캐시 서버의 효율을 좌우하는 요소 중 하나이다.  
> 웹 서버에서 데이터 갱신을 할 때마다 즉시 캐시 서버에 반영해야 한다.    



