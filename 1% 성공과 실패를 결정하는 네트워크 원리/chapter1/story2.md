# chapter 1. 웹 브라우저가 메시지를 만든다 
## story 2. 웹서버의 IP 주소를 DNS 서버에 조회한다
<br/>

### (1) IP 주소의 기본
- 클라이언트는 HTTP의 메시지를 만들어, 이를 웹 서버에게 보내달라고 운영체제에 의뢰한다.
- 이 때, URL 안에 쓰여 있는 서버의 **도메인명**에서 IP 주소를 알아내야 한다.
- 인터넷 또는 사내 LAN은 TCP/IP 개념에 기초하여 만들어져있다.
- TCP/IP는 **서브넷**이라는 작은 네트워크를 **라우터**로 접속하여 전체 네트워크가 만들어진다. 
- 허브에 몇 대의 PC가 접속된 것을 하나의 서브넷, 하나의 단위라고 생각해보자. 이들이 라우터에서 연결되면서 전체 네트워크를 이룬다. 
- 이 때 서브넷에 '네트워크 주소'를, 서브넷에 접속되어 있는 각 컴퓨터에 '호스트 주소'를 할당한 것이 **IP 주소**이다.

```
1. 송신측이 보낸 메시지를 서브넷 내의 허브가 운반한다.
2. 운반한 메시지가 송신측에서 가장 가까운 라우터까지 도착한다.
3. 라우터는 메시지를 보낸 상대를 확인하여 다음 라우터를 판단하고, 그곳으로 보내도록 지시한다.
4. 다시 서브넷의 허브가 라우터까지 메시지를 보낸다.  
(반복)
```
<br/>

### (2) 도메인명과 IP 주소를 구분하여 사용하는 이유
- IP 주소를 알아야지만 통신 상대를 지정할 수 있다는데 그러면 URL 안에 IP 주소를 쓰거나, 프로토콜에서 IP 주소가 아닌 '이름'으로 상대를 지정하여 통신하면 안되는 것일까?
  - URL에 IP 주소를 써도 올바르게 작동하지만, 기억하기 어렵다.
  - 이름으로 통신하는 것은, 4바이트분의 수치만 취급하면 되는 IP주소와 달리 실행 효율이 떨어진다.  
<br/>

### (3) Socket 라이브러리가 IP 주소를 찾는 기능을 제공한다
- IP 주소를 찾는 법
  - 가장 가까운 DNS 서버에게, URL에 해당하는 서버의 IP 주소를 묻는다.
- 브라우저가 DNS 서버에 조회할 수 있는 이유는 소켓 라이브러리에 **DNS 리졸버**(그냥 리졸버라고도 부른다)가 있기 때문이다.
  - DNS 서버에 조회한다 : 조회 요청을 보내고 응답 메시지를 받는다는 뜻
- **소켓 라이브러리**는 OS의 네트워크 기능을 **어플리케이션에서 호출**하기 위한 부품(프로그램)들을 모아둔 것이다.
- DSN 리졸버는 DNS 서버에 대한 클라이언트로서, IP 주소를 조사하는 **네임 리졸루션**을 실행한다.  
<br/>

### (4) 리졸버를 이용하여 DNS 서버를 조회한다
- DNS 리졸버는 소켓 라이브러리 내에 부품화되어 있어서, 어플리케이션인 **브라우저**에서 간단히 호출할 수 있다.  
  - 코드 상에서 리졸버의 프로그램명과 도메인명(웹 서버의 이름)을 쓰기만 하면 호출할 수 있다.
- 즉 브라우저는 리졸버를 통해 알아낸 IP주소를 추출하여, HTTP 요청 메시지와 함께 OS에 건네주며 **송신을 의뢰**할 뿐이다.
<br/>

### (5) 리졸버 내부의 작동
1. 브라우저에서 리졸버를 호출하면, 제어가 리졸부의 내부로 넘어간다.
  - 리졸버를 호출하는 코드를 실행하면 어플리케이션(브라우저)의 동작은 일시적으로 정지하고 리졸버가 실행된다.
2. 리졸버에서는 DNS 서버에 IP주소를 문의하기 위한 **메시지를 만든다**.
3. **메시지의 송수신**은 직접 하지 않고, OS 내부의 **프로토콜 스택**을 호출하여 실행을 의뢰한다.
  - 리졸버에도 데이터 송수신 기능은 없기 때문이다.
  - 여기에서 LAN 어댑터를 통해 메시지가 송신된다.
4. **DNS 서버**는 전달받은 메시지의 내용에 따라 응답 내용을 찾는다.
5. 리졸버는 프로토콜 스택을 경유해 받은 응답 내용을 해독하고, **IP 주소를 추출**해 브라우저에게 전달한다.
  - 실제로는 리졸버 호출 시 지정한 메모리 영역에 IP 주소를 저장한다.
6. 제어가 브라우저로 다시 돌아온다.

- DNS 서버의 IP 주소는 어떻게 알까?
  - DNS 서버에 송신할 때에도 이에 대한 IP 주소가 필요하다.
  - 이는 컴퓨터의 TCP/IP 설정 항목에 미리 설정되어있다.