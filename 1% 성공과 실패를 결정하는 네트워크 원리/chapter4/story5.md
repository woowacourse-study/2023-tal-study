# story 5. 프로바이더를 경유하여 흐르는 패킷
## 1. 프로바이더끼리의 접속

- 서버와 클라이언트가 같은 프로바이더에 접속되어 있는 경우
  - 프로바이더의 라우터는 라우터끼리 경로 정보를 교환하고 경로 표에 자동 등록한다.
- 서버 프로바이더와 클라이언트측이 다른 경우
  - 프로바이더는 다른 프로바이더와 경로 정보를 교환하기 때문에 경로 정보가 등록되어 있다.  

## 2. 프로바이더끼리 경로 정보 교환하기  
> 접속 상대가 경로 정보를 알려주고, 같은 방법으로 상대에게 통지한다.   
> 이는 라우터가 자동적으로 수행하며, 이 구조를 BGP(Border Gateway Protocol) 라고 한다.

### 경로 정보 교환의 유형
- 트랜지트(transit)
  - 접속 상대에게 전체 경로를 통지
- 피어(peer) 또는 비 트랜지트
  - 두 프로바이더가 각각의 네트워크에 관한 경로 정보만 상대에게 통지
  - 상대의 네트워크로 갈 패킷만 흐름


## 3. 사내 네트워크에서 자동 등록하기
> 사내에서 사용하는 구조는 최단 경로를 찾아 중계하도록 만들어짐  
> 이에 주변 전체 라우터와 무차별적으로 경로 정보를 교환함  

- 사내가 아닌 프로바이더라면?
  - 최단 경로로 패킷을 중계하면 다른 프로바이더의 패킷이 회선에 유입될 수 있음
  - 비용 부담에 응하는 프로바이더와 그렇지 않은 프로바이더 구별이 어려워짐
  - 제대로 비용 교섭을 할 수 없게 된다.  
  - 인터넷의 경우 단순히 최단 경로를 선택하지 않고 의도하지 않은 상대로부터 오는 패킷을 중지하는 구조가 필요


### 인터넷의 정보 교환
- 경로 정보를 교환하는 상대 지정 가능 (특정 라우터와 1:1 교환)
- 최단 경로와 다른 요소로 매개변수 설정 가능 (우선순위)
- 경로 정보를 교환하지 않은 상대에게는 패킷 전달 불가

## 4. IX의 필요성
> 프로바이더 접속 방식만으로는 불편하다 (1:1이라 모든 프로바이더를 연결해야 한다)  
> 중심이 되는 설비를 설치하고 경유해서 접속하는 방식을 선택하면 통신 회선의 수를 억제할 수 있다.  
> 이 때 중심 설비가 IX(Internet eXchange) 이다.  

## 5. IX에서 프로바이더끼리 접속하는 모습
> IX 중심에는 고속 LAN 인터페이스를 다수 장착한 레이어 2 스위치가 있다.  
> 레이어 2 스위치의 기본 동작은 스위칭 허브와 같다.  

### IX 레이어 2 스위치와 프로바이더 연결 방법
- IX와 같은 건물에 NOC를 설치한 프로바이더가 선택하는 방법
  - NOC에서 광섬유 케이블을 가설하여 IX의 스위치에 접속하는 것이 통례
- IX의 스위치에 접속하는 벙법
- IX에 라우터를 가지고 들어가 통신 회선으로 접속하고 라우터와 IX의 스위치를 접속하는 방법
- 데이터 센터 등 트래픽이 집중되는 곳에 설치하고 연결하는 방법

