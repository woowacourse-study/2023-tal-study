# story 4. 라우터의 부가 기능
## 1. 주소 변환으로 IP 주소를 효율적으로 이용한다.  
> 라우터의 부가 기능으로는 `주소 변환`과 `패킷 필터링` 기능이 있다.  

### 주소 변환 기능
> **생각해볼 점**  
> 주소는 각 기기를 식별하는 것이므로 중복되지 않는 고유한 값을 할당 해야 한다.  
> 그렇다면 무엇을 가지고 고유하다고 간주할 것인가?  

네트워크가 독립되어 있다면 같은 주소를 사용해도 문제가 발생하지 않는다.  
이렇게 하면 주소를 대폭 절약할 수 있다.  

- 프라이비트 주소(private address)
  - 특정 주소를 사내용으로 사용한다는 규칙 하에 기초한 사내용 주소  
  - 10.0.0.0 ~ 10.255.255.255
  - 172.16.0.0 ~ 172.31.255.255
  - 192.168.0.0 ~ 192.168.255.255


- 글로벌 주소(global address)

프라이비트 주소는 기존에 글로벌 주소에 포함된 주소 중에 범위를 정하고, 사내에서 사용하겠다고 약속한 주소들이다.  
프라이비트 주소라도 사내에서는 중복을 피해야 한다.  

하지만 패킷이 사내와 인터넷을 왕래하면 주소 중복이 발생한다.  
그렇기 때문에 사내 네트워크를 인터넷에 접속할 때, 사내의 네트워크를 인터넷에 공개하는 서버를 접속하는 부분과 사내용 네트워크의 두 가지로 나눈다.  
공개용 서버쪽에는 글로벌 주소를 할당해서 인터넷과 직접 통신한다.  
사내 네트워크에서는 특별한 구조를 사용하여 접속한다 (주소 변환).  

## 2. 주소 변환의 기본 동작
> 주소 변환: 패킷을 중계할 때 IP 헤더에 기재된 IP 주소와 포트번호를 바꿔쓰는 것  

### 주소 변환 흐름
- 패킷의 송신처 IP 주소를 프라이비트 주소에서 글로벌 주소로 바꿔 쓴다.  
  - 글로벌 주소는 주소 변환 장치의 인터넷측에 있는 포트에 할당된 주소이고, 포트 번호도 바꿔 쓴다.
  - 포트 번호는 미사용 번호를 적당히 선택해서 사용
- 글로벌 주소, 포트 번호를 세트로 주소 변환 장치 내부 대응표에 기록함  
- 데이터 송수신을 끝내고 연결 끊기 동작의 패킷이 흐르다가 인터넷에 대한 접속 동작이 끝나면 대응표에 등록한 것을 삭제함  


## 3. 포트 번호를 바꿔쓰는 이유  
> 포트 번호도 함께 사용하지 않고 주소만 바꿔쓴다면 프라이비트 주소와 글로벌 주소가 1:1로 대응해서 인터넷에 접속하는 대수만큼 글로벌 주소가 필요    

- 포트 번호는 16비트 수치이므로 수만 개의 값을 취할 수 있음  
- 글로벌 주소의 이용 효율을 높일 수 있음  


## 4. 인터넷에서 회사로 액세스한다.
> 인터넷에서 사내로 패킷을 중계할 때는 대응표에 등록되어 있지 않으면 중계할 수 없다.   
> 글로벌과 프라이브트의 대응 관계 판단이 불가능하기 때문이다.  
> 즉 사내에서 의도적으로 인터넷에 액세스하지 않는 한 인터넷측에서 사내에 패킷을 보낼 수 없다(부정 침입 방지 효과).  

- 필요하다면 인터넷에서 사내에 액세스하기 위해서 사전에 수동으로 대응표에 등록해두는 방법도 있다.


## 5. 라우터의 패킷 필터링 기능
> 패킷을 중계할 때 MAC 헤더, IP 헤더, TCP 헤더에 기록되어 있는 내용을 조사하여 그것이 사전에 설정한 조건에 합치되면 패킷을 중계하거나 폐기하는 동작을 실행한다.  
> 대부분의 방화벽이라는 기기나 소프트웨어는 이 원리를 이용하여 부정 침입을 방지한다.  

관련해서는 이후에 설명한다고 하네요!  
